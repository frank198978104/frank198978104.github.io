---
layout: post
title:  "Web App 相關技術"
date:   2015-06-17 14:06:05
categories: JavaScript
tags: JavaScript HTML CSS Sass 移動端 XSS AMD requireJS CommonJS 性能優化 WebApp
---

* content
{:toc}

> 往前推2到3年，前端工程師還在憂心忡忡地想，移動互聯網時代下，前端是不是沒有生存空間了。但今天一看，在我們團隊，前端工程師超過一半的工作都是在做移動端的Web或者APP的開發。移動Web或者APP在技術本質上是和做桌面端Web沒有本質區別，但是移動端的坑那是非常的多，通過學習這部分內容，讓你成為一名桌面移動通吃的前端開發工程師。





## 概念

* 參考： [移動 Web 開發入門](http://junmer.github.io/mobile-dev-get-started/)

上面這個 slide 資料講的非常好，算是一個入門的介紹吧。帶我們建立基本的移動 web 開發知識體系和常見問題的實踐。包含以下幾個方面：

* 基本概念
    * Native

        本地應用 使用 Java \ Objective-C \ Swift 開發

    * WebApp

        網頁應用 html5 開發

    * Hybrid

        混合應用 ooxx(native, web)

    * 對比

* 視覺
    * 設備的像素
    * 文字單位使用 rem
    * viewport 屬性
    * 橫屏豎屏
    * Flex 伸縮布局
    * 響應式設計
    * 軟鍵盤
    * 隱藏地址欄
    * 蘋果設備添加到主屏圖標
* 交互
    * Touch
    * click 延遲
    * Scroll
    * Gestures(hammer --A javascript library for multi-touch gestures)
    * 手指友好設計
    * HTML5 APIS（圖像，搖動，聲音等）
* 實踐
    * 屏蔽點擊元素時的陰影
    * 圖像（像素、矢量圖標、base64 減少請求、lazyload）
    * CSS3（合理使用漸變/圓角/陰影、代替 js 動畫、translate3d、解決動畫閃爍）
    * localStorage
    * 避免（iframe、fixed + input）
    * SPA 或 Multi page
    * can I use
    * 壓縮合併
    * @G/3G 下建立連接時間
* 調試
    * 瀏覽器自己的調試工具，模擬手機設備
    * weinre

        關於 weinre 我寫了一篇博客介紹它。[Weinre --WebApp 調試工具](http://gaohaoyang.github.io/2015/06/18/weinre/)

---

## head 標籤

參考：

* [移動前端不得不了解的html5 head 頭標籤](http://www.css88.com/archives/5480)

上面的鏈接詳細的講解了：

* DOCTYPE
* charset
* lang屬性
* 優先使用 IE 最新版本和 Chrome
* 360 使用Google Chrome Frame
* SEO 優化部分：頁面標題<title>標籤(head 頭部必須)，頁面關鍵詞 keywords，頁面描述內容 description，定義網頁作者 author，網頁搜索引擎索引方式
* 為移動設備添加 viewport

    `viewport` 可以讓布局在移動瀏覽器上顯示的更好。 通常會寫

```html
<meta name ="viewport" content ="initial-scale=1, maximum-scale=3, minimum-scale=1, user-scalable=no">
<!-- `width=device-width` 會導致 iPhone 5 添加到主屏後以 WebApp 全屏模式打開頁面時出現黑邊 http://bigc.at/ios-webapp-viewport-meta.orz -->
```

* content 參數：
    * width viewport 寬度(數值/device-width)
    * height viewport 高度(數值/device-height)
    * initial-scale 初始縮放比例
    * maximum-scale 最大縮放比例
    * minimum-scale 最小縮放比例
    * user-scalable 是否允許用戶縮放(yes/no)

* ios 設備，iOS 圖標，Android，Windows 8

**總結：**

```html
<!DOCTYPE html> <!-- 使用 HTML5 doctype，不區分大小寫 -->
<html lang="zh-cmn-Hans"> <!-- 更加標準的 lang 屬性寫法 http://zhi.hu/XyIa -->
<head>
    <!-- 聲明文檔使用的字符編碼 -->
    <meta charset='utf-8'>
    <!-- 優先使用 IE 最新版本和 Chrome -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <!-- 頁面描述 -->
    <meta name="description" content="不超過150個字符"/>
    <!-- 頁面關鍵詞 -->
    <meta name="keywords" content=""/>
    <!-- 網頁作者 -->
    <meta name="author" content="name, email@gmail.com"/>
    <!-- 搜索引擎抓取 -->
    <meta name="robots" content="index,follow"/>
    <!-- 為移動設備添加 viewport -->
    <meta name="viewport" content="initial-scale=1, maximum-scale=3, minimum-scale=1, user-scalable=no">
    <!-- `width=device-width` 會導致 iPhone 5 添加到主屏後以 WebApp 全屏模式打開頁面時出現黑邊 http://bigc.at/ios-webapp-viewport-meta.orz -->

    <!-- iOS 設備 begin -->
    <meta name="apple-mobile-web-app-title" content="標題">
    <!-- 添加到主屏後的標題（iOS 6 新增） -->
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <!-- 是否啟用 WebApp 全屏模式，刪除蘋果默認的工具欄和菜單欄 -->

    <meta name="apple-itunes-app" content="app-id=myAppStoreID, affiliate-data=myAffiliateData, app-argument=myURL">
    <!-- 添加智能 App 廣告條 Smart App Banner（iOS 6+ Safari） -->
    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
    <!-- 設置蘋果工具欄顏色 -->
    <meta name="format-detection" content="telphone=no, email=no"/>
    <!-- 忽略頁面中的數字識別為電話，忽略email識別 -->
    <!-- 啟用360瀏覽器的極速模式(webkit) -->
    <meta name="renderer" content="webkit">
    <!-- 避免IE使用兼容模式 -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- 針對手持設備優化，主要是針對一些老的不識別viewport的瀏覽器，比如黑莓 -->
    <meta name="HandheldFriendly" content="true">
    <!-- 微軟的老式瀏覽器 -->
    <meta name="MobileOptimized" content="320">
    <!-- uc強制豎屏 -->
    <meta name="screen-orientation" content="portrait">
    <!-- QQ強制豎屏 -->
    <meta name="x5-orientation" content="portrait">
    <!-- UC強制全屏 -->
    <meta name="full-screen" content="yes">
    <!-- QQ強制全屏 -->
    <meta name="x5-fullscreen" content="true">
    <!-- UC應用模式 -->
    <meta name="browsermode" content="application">
    <!-- QQ應用模式 -->
    <meta name="x5-page-mode" content="app">
    <!-- windows phone 點擊無高光 -->
    <meta name="msapplication-tap-highlight" content="no">
    <!-- iOS 圖標 begin -->
    <link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-57x57-precomposed.png"/>
    <!-- iPhone 和 iTouch，默認 57x57 像素，必須有 -->
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/apple-touch-icon-114x114-precomposed.png"/>
    <!-- Retina iPhone 和 Retina iTouch，114x114 像素，可以沒有，但推薦有 -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144x144-precomposed.png"/>
    <!-- Retina iPad，144x144 像素，可以沒有，但推薦有 -->
    <!-- iOS 圖標 end -->

    <!-- iOS 啟動畫面 begin -->
    <link rel="apple-touch-startup-image" sizes="768x1004" href="/splash-screen-768x1004.png"/>
    <!-- iPad 豎屏 768 x 1004（標準分辨率） -->
    <link rel="apple-touch-startup-image" sizes="1536x2008" href="/splash-screen-1536x2008.png"/>
    <!-- iPad 豎屏 1536x2008（Retina） -->
    <link rel="apple-touch-startup-image" sizes="1024x748" href="/Default-Portrait-1024x748.png"/>
    <!-- iPad 橫屏 1024x748（標準分辨率） -->
    <link rel="apple-touch-startup-image" sizes="2048x1496" href="/splash-screen-2048x1496.png"/>
    <!-- iPad 橫屏 2048x1496（Retina） -->

    <link rel="apple-touch-startup-image" href="/splash-screen-320x480.png"/>
    <!-- iPhone/iPod Touch 豎屏 320x480 (標準分辨率) -->
    <link rel="apple-touch-startup-image" sizes="640x960" href="/splash-screen-640x960.png"/>
    <!-- iPhone/iPod Touch 豎屏 640x960 (Retina) -->
    <link rel="apple-touch-startup-image" sizes="640x1136" href="/splash-screen-640x1136.png"/>
    <!-- iPhone 5/iPod Touch 5 豎屏 640x1136 (Retina) -->
    <!-- iOS 啟動畫面 end -->

    <!-- iOS 設備 end -->
    <meta name="msapplication-TileColor" content="#000"/>
    <!-- Windows 8 磁貼顏色 -->
    <meta name="msapplication-TileImage" content="icon.png"/>
    <!-- Windows 8 磁貼圖標 -->

    <link rel="alternate" type="application/rss+xml" title="RSS" href="/rss.xml"/>
    <!-- 添加 RSS 訂閱 -->
    <link rel="shortcut icon" type="image/ico" href="/favicon.ico"/>
    <!-- 添加 favicon icon -->

    <title>標題</title>
</head>
<body>
</body>
</html>
```

## 頁面切換動畫

* [移動端重構系列13——頁面切換](http://www.w3cplus.com/mobile/mobile-terminal-refactoring-slider.html)
* [CSS3 3D Transform](http://www.w3cplus.com/css3/css3-3d-transform.html)

關於 HammerJS 的一個中文文檔

* [Hammer.js](http://www.cnblogs.com/iamlilinfeng/p/4239957.html)

---

## CSS Processing

> CSS語言由於其自身語言設計的問題，加上一些瀏覽器兼容性問題，往往會使得我們在寫它的時候，要寫很多冗余代碼，或者為了兼容性對同一個樣式設定寫好幾遍。針對這些問題，誕生了CSS預處理和後處理的概念及相關方法、工具。
>
> 這些工具和方法幫助我們能夠更加高效地書寫可維護性更強的CSS代碼。

這裡我嘗試使用了 Sass，果然很好用。下面記錄幾個 sass 教程。

* [Sass入門-w3cplus](http://www.w3cplus.com/sassguide/)
* [SASS用法指南-阮一峰](http://www.ruanyifeng.com/blog/2012/06/sass.html)

### 安裝

首先要有 ruby 環境。

由於國內網絡原因（你懂的），導致 rubygems.org 存放在 Amazon S3 上面的資源文件間歇性連接失敗。這時候我們可以通過gem sources命令來配置源，先移除默認的 https://rubygems.org 源，然後添加淘寶的源 https://ruby.taobao.org/，然後查看下當前使用的源是哪個，如果是淘寶的，則表示可以輸入 sass 安裝命令 `gem install sass` 了。

    $ gem sources --remove https://rubygems.org/
    $ gem sources -a https://ruby.taobao.org/
    $ gem sources -l
    *** CURRENT SOURCES ***

    https://ruby.taobao.org
    # 請確保只有 ruby.taobao.org
    $ gem install sass

### 編譯

    sass --watch style.scss:style.css --style expanded

---

### 補充

**`rem`**

字體單位使用 rem，用戶在手機上設置了字體大小時，不會打破布局，造成混亂。

* [CSS3的REM設置字體大小-w3cplus](http://www.w3cplus.com/css3/define-font-size-with-css3-rem)
* [響應式十日談第一日：使用 rem 設置文字大小-一絲](http://www.iyunlu.com/view/css-xhtml/76.html)

---

## 安全

> 安全是大家經常容易忽視，但其實一旦出現影響會非常大的問題，尤其對於沒有經歷過企業開發，或者沒有踩過坑的同學，如果等到公司工作，做實際項目後非常容易發生安全問題。

### 分類

WEB基本攻擊大致可以分為三大類：“資源枚舉”、“參數操縱” 和 “其它攻擊”

* 資源枚舉
* 參數操縱
    * SQL注入
    * XPath注入
    * cgi命令執行
    * XXS（cross-site scripting跨域腳本攻擊）其重點是“跨域”和“客戶端執行”
        * Reflected XSS ——基於反射的XSS攻擊。主要依靠站點服務端返回腳本，在客戶端觸發執行從而發起WEB攻擊。
        * DOM-based or local XSS——基於DOM或本地的XSS攻擊
        * Stored XSS——基於存儲的XSS攻擊
    * 會話劫持
* 其它攻擊
    * CSRF（cross-site request forgery）跨站請求偽造
    * 釣魚攻擊指的是網站的偽造，比如ta0bao.com，然後在其中應用XSS等方式發起攻擊。
    * 拒絕服務（DoS）指的是向網站發起洪水一樣的請求（Traffic Floor），導致服務器超負荷並關閉，處理方法常規是採用QoS（Quality of Service）的軟硬件解決方案。

### 關於 XSS

> **跨網站腳本**（Cross-site scripting，通常簡稱為XSS或跨站腳本或跨站腳本攻擊）是一種網站應用程序的安全漏洞攻擊，是代碼注入的一種。它允許惡意用戶將代碼注入到網頁上，其他用戶在觀看網頁時就會受到影響。這類攻擊通常包含了HTML以及用戶端腳本語言。
>
> XSS攻擊通常指的是通過利用網頁開發時留下的漏洞，通過巧妙的方法注入惡意指令代碼到網頁，使用戶加載並執行攻擊者惡意製造的網頁程序。這些惡意網頁程序通常是JavaScript，但實際上也可以包括Java， VBScript， ActiveX， Flash 或者甚至是普通的HTML。攻擊成功後，攻擊者可能得到更高的權限（如執行一些操作）、私密網頁內容、會話和cookie等各種內容。
>
> ——維基百科

### XSS 防護

1. 瀏覽器解析順序：

    HTML Parser >> CSS Parser >> JavaScript Parser

2. 瀏覽器解碼順序：

    HTML Decoding >> URL Decoding >> JavaScript Decoding

3. 具體的防護方式：

    * 驗證輸入並且基於語境和按照正確的順序轉義不可信數據
        * HTML 中的字符串
        * HTML 屬性中的字符串
        * 事件句柄屬性和 JavaScript 中的字符串
        * HTML 屬性中的 URL 路徑
        * HTML 風格屬性和 CSS 中的字符串
        * JavaScript 中的 HTML
    * 始終遵循白名單優於黑名單的做法
    * 使用 UTF-8 為默認的字符編碼以及設置 content 為 text/html
    * 不要將用戶可以控制的文本放在<meta>標籤前。通過使用不同的字符集注射可以導致 XSS。
    * 使用 <!DOCTYPE html>
    * 使用推薦的 HTTP 響應頭進行 XSS 防護
    * 防止 CRLF 注入/HTTP 響應拆分
    * 禁止 TRACE 和其他非必要方法


對於 innerHTML 的方式輸出的，我們可以採用如下的方式轉碼

```js
/**
 * 轉碼 XSS 防護
 * @param  {String} str 用戶輸入的字符串
 * @return {String}     轉碼後的字符串
 */
function changeCode(str) {
    str = str.replace(/&/g, "&amp;")
              .replace(/</g, "&lt;")
              .replace(/>/g, "&gt;")
              .replace(/"/g, "&quot;")
              .replace(/'/g, "&#x27;")
              .replace(/\//g, "&#x2f;");
    return str;
}
```

---

參考：

* [淺談WEB安全性（前端向）](http://www.cnblogs.com/vajoy/p/4176908.html)
* [XSS的原理分析與解剖](http://www.freebuf.com/articles/web/40520.html)
* [原創翻譯：給開發者的終極XSS防護備忘錄](http://www.fooying.com/chinese-translationthe-ultimate-xss-protection-cheatsheet-for-developers/)

---

## 性能優化

> 在自己做一些小項目時，可能是學校的一些網站項目，流量可能日均都不超過500，而且大多是校園局域網內訪問；或者是開發一些實驗室的MIS系統，這輩子你都不會去使用你開發的這個系統。在這樣一些項目中，性能優化往往會被你忽略。
>
> 但是如果你是做一個日均PV數萬、數十萬、甚至更大的量級，開發的頁面會被全國各地，不同網絡條件的用戶來進行訪問。這個時候，性能問題就無法忽視了。在當今的網絡條件下，如果你的頁面3秒都無法完成首屏渲染，一定會讓你的網站流失很多用戶。
>
> 整個網站的性能優化有很多的環節和工作，大多數時候，不是前端工程師單獨就能完成的，尤其在職能劃分明確的公司中，往往需要前後端、運維、DBA等多個職位協同完成。所以，在我們的課程中，主要讓你了解整個性能優化都涉及哪些方面的工作，同時，我們會專注介紹一些在前端領域可以重點關注的技術點。

這裡就是網頁的打開速度，如果你的網頁打開速度很慢，那麼一定會有用戶的流失。所以性能優化很重要。

* 網頁內容
    * 減少http請求次數
    * 減少DNS查詢次數
    * 避免頁面跳轉
    * 緩存Ajax
    * 延遲加載
    * 提前加載
    * 減少DOM元素數量
    * 根據域名劃分內容
    * 減少iframe數量
    * 避免404
* 服務器
    * 使用CDN
    * 添加Expires 或Cache-Control報文頭
    * Gzip壓縮傳輸文件
    * 配置ETags
    * 盡早flush輸出
    * 使用GET Ajax請求
    * 避免空的圖片src
* Cookie
    * 減少Cookie大小
    * 頁面內容使用無cookie域名
* CSS
    * 將樣式表置頂
    * 避免CSS表達式
    * 用\<link\>代替@import
    * 避免使用Filters
* Javascript
    * 將腳本置底
    * 使用外部Javascirpt和CSS文件
    * 精簡Javascript和CSS
    * 去除重複腳本
    * 減少DOM訪問
    * 使用智能事件處理
* 圖片
    * 優化圖像
    * 優化CSS Sprite
    * 不要在HTML中縮放圖片
    * 使用小且可緩存的favicon.ico
* 移動客戶端
    * 保持單個內容小於25KB
    * 打包組建成符合文檔

具體細節參考文章：

* [毫秒必爭，前端網頁性能最佳實踐](http://www.cnblogs.com/developersupport/p/webpage-performance-best-practices.html)

我在 ToDo 這個任務中主要使用了 CDN 來加載靜態資源。比如我使用了 [百度靜態資源公共庫](http://cdn.code.baidu.com/)。引用了裡面的 fontawesome，速度果然比在 GitHub 倉庫裡快很多。下一步是壓縮我自己寫的靜態資源。

其他參考資料：

* [給網頁設計師和前端開發者看的前端性能優化](http://www.oschina.net/translate/front-end-performance-for-web-designers-and-front-end-developers#section:maximising-parallelisation)
* [梳理：提高前端性能方面的處理以及不足](http://www.zhangxinxu.com/wordpress/?p=3152)
* [css sprite原理優缺點及使用](http://www.cnblogs.com/mofish/archive/2010/10/12/1849062.html)
* [CSS Sprites：魚翅還是三鹿？](http://www.qianduan.net/css-sprites-useful-technique-or-potential-nuisance/)
* [大型網站的靈魂——性能](http://www.cnblogs.com/leefreeman/p/3998757.html)
* [編寫高效的 CSS 選擇器](http://web.jobbole.com/35339/)

---

## 模塊化

> 對於一個複雜項目，特別是多人協作的複雜項目，如何合理劃分模塊，如何更加方便地進行模塊加載，如何管理模塊之間的依賴，是一個項目團隊都會面臨的問題，目前業界已經有了一些較為普遍的解決方案，如AMD。這個部分希望你能夠通過學習JavaScript的模塊化，學習如何合理地規劃項目模塊，合理使用模塊化工具來優化你的項目代碼結構。

一個模塊就是實現特定功能的文件，有了模塊，我們就可以更方便地使用別人的代碼，想要什麼功能，就加載什麼模塊。模塊開發需要遵循一定的規範，否則就都亂套了。

根據AMD規範，我們可以使用 `define` 定義模塊，使用 `require` 調用模塊。

目前，通行的 js 模塊規範主要有兩種：`CommonJS` 和 `AMD`。

### AMD規範

AMD 即 Asynchronous Module Definition，中文名是“異步模塊定義”的意思。它是一個在瀏覽器端模塊化開發的規範，服務器端的規範是 CommonJS

模塊將被異步加載，模塊加載不影響後面語句的運行。所有依賴某些模塊的語句均放置在回調函數中。

AMD 是 RequireJS 在推廣過程中對模塊定義的規範化的產出。

詳細 API 如下：

* [AMD（中文版）](https://github.com/amdjs/amdjs-api/wiki/AMD-(%E4%B8%AD%E6%96%87%E7%89%88))

---

### CommonJS規範

CommonJS 是服務器端模塊的規範，Node.js 採用了這個規範。Node.JS 首先採用了 js 模塊化的概念。

根據 CommonJS 規範，一個單獨的文件就是一個模塊。每一個模塊都是一個單獨的作用域，也就是說，在該模塊內部定義的變量，無法被其他模塊讀取，除非定義為 global 對象的屬性。

輸出模塊變量的最好方法是使用 module.exports 對象。

---

### 為什麼要用 requireJS

試想一下，如果一個網頁有很多的js文件，那麼瀏覽器在下載該頁面的時候會先加載js文件，從而停止了網頁的渲染，如果文件越多，瀏覽器可能失去響應。其次，要保證js文件的依賴性，依賴性最大的模塊（文件）要放在最後加載，當依賴關係很複雜的時候，代碼的編寫和維護都會變得困難。

RequireJS就是為了解決這兩個問題而誕生的：

> （1）實現js文件的異步加載，避免網頁失去響應；
> （2）管理模塊之間的依賴性，便於代碼的編寫和維護。

#### requireJS

* [requireJS 官網](http://requirejs.org/)
* [requireJS 中文網](http://www.requirejs.cn/)

---

### AMD和CMD

CMD（Common Module Definition） 通用模塊定義。該規範明確了模塊的基本書寫格式和基本交互規則。該規範是在國內發展出來的。AMD是依賴關係前置，CMD是按需加載。

> AMD 是 RequireJS 在推廣過程中對模塊定義的規範化產出。
> CMD 是 SeaJS 在推廣過程中對模塊定義的規範化產出。

* [CMD 模塊定義規範](https://github.com/seajs/seajs/issues/242)

對於依賴的模塊，AMD 是提前執行，CMD 是延遲執行。

> AMD:提前執行（異步加載：依賴先執行）+延遲執行
> CMD:延遲執行（運行到需加載，根據順序執行）

---


### 參考   

* [Javascript模塊化編程（一）：模塊的寫法--阮一峰](http://www.ruanyifeng.com/blog/2012/10/javascript_module.html)
* [Javascript模塊化編程（二）：AMD規範](http://www.ruanyifeng.com/blog/2012/10/asynchronous_module_definition.html)
* [Javascript模塊化編程（三）：require.js的用法](http://www.ruanyifeng.com/blog/2012/11/require_js.html)
* [詳解 JavaScript 模塊開發](http://segmentfault.com/a/1190000000733959)
* [淺談模塊化的JavaScript](http://www.cnblogs.com/jinguangguo/archive/2013/04/06/3002515.html?utm_source=tuicool)
* [再談 SeaJS 與 RequireJS 的差異](http://div.io/topic/430)
* 玩轉AMD系列 by erik@EFE
    * [玩轉AMD - 寫在前面](http://efe.baidu.com/blog/dissecting-amd-preface/)
    * [玩轉AMD - 設計思路](http://efe.baidu.com/blog/dissecting-amd-what/)
    * [玩轉AMD - 應用實踐](http://efe.baidu.com/blog/dissecting-amd-how/)
    * [玩轉AMD - Loader](http://efe.baidu.com/blog/dissecting-amd-loader/)   



---


## 前端工程化

> 業界目前有非常多的前端開發工具，完成一些開發過程中可以自動化完成的工作，提高研發效率，並且可以提高多人協作時的開發過程一致性，提高整個項目的運維效率。
>
> 在EFE日常工作中，我們是基於EDP，完成項目開發過程中的項目構建、包管理、調試、單測、靜態檢測、打包、壓縮、優化、項目部署等一系列所有工作。

注：

如果網絡不好，可以使用 [淘寶 NPM 鏡像](http://npm.taobao.org/)。

### 參考

* [前端工程與模塊化框架](http://div.io/topic/439)
* [手機百度前端工程化之路](http://mweb.baidu.com/p/baidusearch-front-end-road.html)
* [對話百度前端工程師張雲龍：F.I.S與前端工業化](http://www.infoq.com/cn/articles/yunlong-on-fis)
* [EDP](https://github.com/ecomfe/edp)
* [Grunt教程——初涉Grunt](http://www.w3cplus.com/tools/grunt-tutorial-start-grunt.html)
* [gulp入門指南](http://www.open-open.com/lib/view/open1417068223049.html)
* [Gulp開發教程（翻譯）](http://www.w3ctech.com/topic/134)
* [Gulp 中文網](http://www.gulpjs.com.cn/)
* [npm的package.json中文文檔](https://github.com/ericdum/mujiang.info/issues/6)

---

## 最終作品

在任務三中，做了一個 PC 端的 ToDo 應用。任務四是將它優化，以適應移動端設備。

### ToDo WebApp Version

* [任務四要求](https://github.com/baidu-ife/ife/tree/master/task/task0004)
* [源代碼](https://github.com/Gaohaoyang/ToDo-WebApp)
* [在線 demo](http://gaohaoyang.github.io/ToDo-WebApp/)
* 手機查看 ↓ 二維碼 ↓

    ![todoWebApp](http://7q5cdt.com1.z0.glb.clouddn.com/task4-code-todoWebApp.png)

* [我的博客 HyG](http://gaohaoyang.github.io)

### Details

* **數據存儲**

    以 JSON 模擬數據表的形式存儲於 LocalStorage 中

         使用數據庫的思想，構建3張表。
         cateJson 分類
         childCateJson 子分類
         taskJson 任務

         分類表 cate
         ----------------------
         id* | name | child(FK)
         ----------------------

         子分類表 childCate
         --------------------------------
         id* | pid(FK) | name | child(FK)
         --------------------------------

         任務表 task
         ----------------------------------------------
         id* | pid(FK) | finish | name | date | content
         ----------------------------------------------

* **使用 `Sass` 重構了 CSS 代碼**

    使用分塊、繼承等方式，使得代碼更加清晰明了。

* **響應式布局**

    針對手機端細節做了很多調整，更符合手機上的視覺交互習慣。

* **加入頁面切換效果**

    使用 `translate3d()`，純 CSS3 切換動畫效果。

* **處理了 XSS 防護**

    對可能造成破壞的字符進行轉碼。

* **性能優化**

    使用 CDN 處理靜態資源 fontAwesome，壓縮靜態資源等

* **模塊化**

    使用 requireJS 模塊化 JavaScript 代碼。重構 JavaScript 代碼。優化之前寫的耦合性高的綁定事件，重新綁定事件，降低耦合性。期間根據具體需求重寫了事件代理的代碼。

* **前端工程化**

    使用 gulp，自動編譯 Sass，壓縮 CSS 和 JavaScript 代碼。並且配置了自動流程。



---

## 其他

### `-webkit-tap-highlight-color` 屬性

感謝 [fiona](https://github.com/fiona23) 指出。

safari移動端點擊的時候會閃一下加上 `-webkit-tap-highlight-color: transparent;` 就不會閃了。

參考：

* [`-webkit-tap-highlight-color`  css88](http://www.css88.com/webkit/-webkit-tap-highlight-color/)
* [`-webkit-tap-highlight-color` 屬性](http://ued.ctrip.com/webkitcss/prop/tap-highlight-color.html)

---

### textarea 標籤 disabled 顏色

* 為什麼用 disabled 屬性？

    因為我發現僅僅使用 readonly 屬性，在 IE 下是顯示光標的。於是使用 disabled。

* 出現的問題

    各家瀏覽器對於 disabled 屬性有自己的樣式設定，比如 IE 下是灰色的。蘋果設備下也是。改變這些樣式的方法也不是統一的。如果要兼容 Safari 必須加上

```
background: #fff;
-webkit-text-fill-color: rgba(0, 0, 0, 1);
-webkit-opacity: 1;
```

於是最終代碼如下：

```css
textarea:disabled {
    color:#000;
    background: #fff;
    -webkit-text-fill-color: rgba(0, 0, 0, 1);
    -webkit-opacity: 1;
}
```

* 參考：[Disabled input text color 中的評論](http://stackoverflow.com/a/4648315)
